<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Trade - Chord Diagrams</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <link rel="stylesheet" type="text/css" href="../bower_components/angular-material/angular-material.css">
    <link rel="stylesheet" type="text/css" href="../css/trade-theme.css">
    <link rel="stylesheet" type="text/css" href="../css/app.css">
  </head>
  <body ng-app="app" ng-controller="mainCntrl" md-theme="trade">
    <md-toolbar style="z-index:0;">
      <h1 class="md-toolbar-tools">
        <span>International Trade (1870-2005)</span>
      </h1>
    </md-toolbar>

    <md-content layout="horizontal" layout-padding>
      <md-whiteframe flex="15" class="md-whiteframe-z3" layout layout-align="center center">
         <md-radio-group ng-model="selected_year">
          <md-radio-button ng-repeat="year in years" ng-value="year" ng-click="change(year)">
            {{ year }}
          </md-radio-button>
        </md-radio-group>
      </md-whiteframe>
      <div flex style="position:relative;">
        <h2 style="margin:0px;">Selected Year: <span class="radioValue">{{ selected_year }}</span></h2>
        <md-whiteframe class="tooltip md-whiteframe-z3" layout="vertical" layout-align="center center">
          <md-list layout="vertical">
            <md-item>
              <md-item-content>
                <div class="md-tile-content">
                  <h3>{{ tooltip.sname }} imported from  {{ tooltip.tname }} : $ {{ qFormat(tooltip.svalue) }}M</h3>
                  <h4>{{ pFormat(tooltip.svalue/tooltip.stotal) }} of {{ tooltip.sname }}'s Total ($ {{ qFormat(tooltip.stotal) }}M)</h4>
                  <p>{{ pFormat(tooltip.svalue/tooltip.mtotal) }} of {{ selected_year }} Total ($ {{ qFormat(tooltip.mtotal) }}M)</p>
                </div>
              </md-item-content>
            </md-item>
            <md-item>
              <md-item-content>
                <div class="md-tile-content">
                  <h3>{{ tooltip.tname }} imported from  {{ tooltip.sname }} : $ {{ qFormat(tooltip.tvalue) }}M</h3>
                  <h4>{{ pFormat(tooltip.tvalue/tooltip.ttotal) }} of {{ tooltip.tname }}'s Total ($ {{ qFormat(tooltip.ttotal) }}M)</h4>
                  <p>{{ pFormat(tooltip.tvalue/tooltip.mtotal) }} of {{ selected_year }} Total ($ {{ qFormat(tooltip.mtotal) }}M)</p>
                </div>
              </md-item-content>
            </md-item>
          </md-list>
        </md-whiteframe>
        <chord-diagram></chord-diagram>
      </div>
    </md-content>
    <hr/>
    <p>Colors By <a target="_blank" href="http://en.wikipedia.org/wiki/Paul_Klee">Paul Klee</a></p>
    <a target="_blank" href="http://www.delimited.io/blog">delimited.io</a>
    <script src="../bower_components/d3/d3.min.js"></script>
    <script src="../bower_components/jquery/dist/jquery.min.js"></script>
    <script src="../bower_components/angular/angular.js"></script>
    <script src="../bower_components/angular-aria/angular-aria.js"></script>
    <script src="../bower_components/angular-animate/angular-animate.js"></script>
    <script src="../bower_components/hammerjs/hammer.js"></script>
    <script src="../bower_components/angular-material/angular-material.js"></script>
    <script>
      angular.module('app', ['ngMaterial']);

      angular.module('app').controller('mainCntrl', ['$scope', 
      function ($scope) {

        $scope.master = [];
        $scope.selected_year = 2005;
        $scope.years = d3.range(2005,1865,-5);
        $scope.tooltip = {};
        $scope.pFormat = d3.format(".1%");
        $scope.qFormat = d3.format(",.0f");

        $scope.updateTooltip = function (data) {
          $scope.tooltip = data;
          $scope.$apply();
          console.log("scope", $scope)
        }

        $scope.change = function (year) {
          $scope.selected_year = year;
          update();
        }

        d3.csv('../data/all_countries.csv', function (err, data) {

          data.forEach(function (d) {
            d.year  = +d.year;
            d.flow1 = +d.flow1;
            d.flow2 = +d.flow2;
          })

          $scope.master = data;
          update();
        })

        function update() {
          $scope.drawChords($scope.master.filter(function (d) {
            return d.year === $scope.selected_year;
          }))
        }


      }]);
    </script>
    <script src="../js/matrixFactory.js"></script>
    <script src="../js/chordDirective.js"></script>
  </body>
</html>